---
/* src/components/ThemeToggle.astro */
---

<button class='theme-toggle-btn' type='button' aria-label='切换暗色/浅色模式'>
    <div class='taichi'></div>
</button>

<style>
    /* 1. 按钮容器样式 */
    .theme-toggle-btn {
        /* 布局 */
        display: inline-flex;
        align-items: center;
        justify-content: center;

        /* 尺寸与重置 */
        padding: 0; /* 覆盖 Global CSS 中的 padding: 4px */
        margin: 0; /* 交给父级 flex gap 控制间距 */
        width: auto;
        height: auto;

        /* 风格重置 */
        background: none;
        border: none;
        outline: none;
        cursor: pointer;

        /* 颜色与过渡 */
        color: var(--primary-text-color); /* 使用全局定义的主文本色 */
        transition:
            color 0.2s ease,
            transform 0.2s ease;

        /* 微调：为了视觉平衡，稍微往上提 1px */
        transform: translateY(-1px);
    }

    /* 2. 悬停效果：使用全局定义的强调色 (Maroon/Red) */
    .theme-toggle-btn:hover {
        color: var(--accent-color);
        transform: translateY(-1px) scale(1.1); /* 微微放大 */
    }

    /* 3. 点击/聚焦时的轮廓消除，或者自定义 */
    .theme-toggle-btn:focus-visible {
        outline: 2px solid var(--accent-color);
        outline-offset: 4px;
        border-radius: 50%;
    }

    /* =========================================
       太极图标 (纯 CSS 绘制)
       ========================================= */
    .taichi {
        position: relative;
        /* 尺寸：20px 显得精致，和你的 15px 正文/导航字体搭配正好 */
        width: 20px;
        height: 20px;
        border-radius: 50%;

        /* 边框：使用 1.5px 实线，颜色继承文字颜色 */
        border: 1.5px solid currentColor;
        box-sizing: border-box;

        /* 背景：线性渐变画出黑白两半 */
        background: linear-gradient(90deg, currentColor 50%, transparent 50%);

        /* 旋转动画 */
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* 上下两个小圆 (头部和尾部) */
    .taichi::before,
    .taichi::after {
        content: "";
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 50%; /* 占整体的一半宽 */
        height: 50%;
        border-radius: 50%;
        box-sizing: border-box;
    }

    /* 上圆：实心色背景 + 页面背景色的小点 */
    .taichi::before {
        top: 0;
        background-color: currentColor;
        /* 关键：用边框模拟中间的“眼”，颜色必须取自全局背景变量 */
        border: 3px solid var(--primary-fill-color);
    }

    /* 下圆：透明背景 + 实心色的小点 */
    .taichi::after {
        bottom: 0;
        background-color: var(--primary-fill-color);
        /* 关键：边框颜色是当前文字色 */
        border: 3px solid currentColor;
    }

    /* =========================================
       暗色模式适配
       ========================================= */

    /* 旋转 180 度 */
    :global(.dark) .taichi {
        transform: rotate(180deg);
    }
</style>

<script>
    // 逻辑保持不变，依然健壮
    function initThemeToggle() {
        const handleToggleClick = () => {
            const element = document.documentElement;
            element.classList.toggle("dark");

            const isDark = element.classList.contains("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");

            document.querySelectorAll(".theme-toggle-btn").forEach((btn) => {
                btn.setAttribute("aria-pressed", isDark ? "true" : "false");
            });
        };

        const btns = document.querySelectorAll(".theme-toggle-btn");
        btns.forEach((btn) => {
            btn.removeEventListener("click", handleToggleClick);
            btn.addEventListener("click", handleToggleClick);
            btn.setAttribute(
                "aria-pressed",
                document.documentElement.classList.contains("dark")
                    ? "true"
                    : "false"
            );
        });
    }

    initThemeToggle();
    document.addEventListener("astro:page-load", initThemeToggle);

    const theme = (() => {
        if (
            typeof localStorage !== "undefined" &&
            localStorage.getItem("theme")
        ) {
            return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            return "dark";
        }
        return "light";
    })();

    if (theme === "light") {
        document.documentElement.classList.remove("dark");
    } else {
        document.documentElement.classList.add("dark");
    }
    window.localStorage.setItem("theme", theme);
</script>
